<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teachers Quorum</title>
<style>
:root {
  --accent:#2196f3; --accent-light:#bbdefb; --accent-hover:#1976d2;
  --bg:#e3f2fd; --card:#fff; --admin:#1565c0;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Segoe UI',sans-serif;background:var(--bg);color:#333;min-height:100vh}
header{background:linear-gradient(90deg,#64b5f6,#90caf9);color:#fff;padding:1rem 2rem;text-align:center;position:relative}
header h1{margin-bottom:.2rem}
#logout{position:absolute;right:20px;top:15px;background:var(--accent);border:none;color:#fff;padding:.4rem .8rem;border-radius:6px;cursor:pointer}
.container{display:flex;justify-content:center;align-items:center;min-height:80vh}
form{background:var(--card);padding:2rem;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);width:320px}
input{width:100%;padding:.6rem;margin:.5rem 0;border:1px solid #ccc;border-radius:6px}
button{width:100%;padding:.6rem;margin-top:.5rem;border:none;border-radius:6px;background:var(--accent);color:white;cursor:pointer}
button:hover{background:var(--accent-hover)}
a{display:block;text-align:center;margin-top:1rem;color:var(--accent)}
#main{display:none;padding:2rem;gap:2rem;grid-template-columns:1fr 1fr}
section{background:var(--card);padding:1.5rem;border-radius:12px;box-shadow:0 4px 8px rgba(0,0,0,0.05)}
#messages{border:1px solid #ddd;padding:.5rem;height:300px;overflow-y:auto;background:#f5faff;border-radius:6px;margin-bottom:1rem}
.message{padding:.5rem .8rem;margin:.3rem 0;border-radius:6px;animation:fade .3s}
.message.you{border-left:4px solid var(--accent)}
#chat-input{margin-bottom:.5rem}
#clear{display:none;background:var(--admin)}
#schedule-table{width:100%;border-collapse:collapse}
#schedule-table th,#schedule-table td{padding:.6rem .8rem;border:1px solid #ddd}
#schedule-table th{background:var(--accent-light);position:sticky;top:0}
@keyframes fade{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>

<header>
  <h1>Teachers Quorum</h1>
  <button id="logout" onclick="logout()">Logout</button>
</header>

<div id="login" class="container">
  <form onsubmit="doLogin(event)">
    <h2>Login</h2>
    <input id="login-email" type="email" placeholder="Email" required>
    <input id="login-pass" type="password" placeholder="Password" required>
    <button>Login</button>
    <a href="#" onclick="showSignup()">Create Account</a>
  </form>
</div>

<div id="signup" class="container" style="display:none">
  <form onsubmit="doSignup(event)">
    <h2>Sign Up</h2>
    <input id="signup-name" placeholder="Full Name" required>
    <input id="signup-email" type="email" placeholder="Email" required>
    <input id="signup-pass" type="password" placeholder="Password" required>
    <button>Sign Up</button>
    <a href="#" onclick="showLogin()">Back to Login</a>
  </form>
</div>

<div id="main" style="display:none;grid">
  <section>
    <h2>Schedule</h2>
    <table id="schedule-table">
      <thead><tr><th>Day</th><th>Subject</th><th>Time</th></tr></thead>
      <tbody id="schedule-body"></tbody>
    </table>
  </section>

  <section>
    <h2>Chat</h2>
    <div id="messages"></div>
    <input id="chat-input" placeholder="Type a message...">
    <button onclick="sendMessage()">Send</button>
    <button id="clear" onclick="clearChat()">Clear Chat</button>
  </section>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey:"AIzaSyCHvfjuoQUP5E3AeNRty2RxJeUD-vOL_bI",
  authDomain:"teachers-quorum-site.firebaseapp.com",
  databaseURL:"https://teachers-quorum-site-default-rtdb.firebaseio.com",
  projectId:"teachers-quorum-site",
  storageBucket:"teachers-quorum-site.firebasestorage.app",
  messagingSenderId:"1036871246524",
  appId:"1:1036871246524:web:4a4dc6bd9e62f03d9a26b9"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

let meName="", meUid="";

auth.onAuthStateChanged(user=>{
  if(user){
    meName=user.displayName||user.email.split("@")[0];
    meUid=user.uid;
    document.getElementById("login").style.display="none";
    document.getElementById("signup").style.display="none";
    document.getElementById("main").style.display="grid";
    if(user.email==="sterlingwbeck@gmail.com") document.getElementById("clear").style.display="block";
    loadChat();
  }else{
    document.getElementById("main").style.display="none";
    document.getElementById("login").style.display="flex";
  }
});

function doSignup(e){
  e.preventDefault();
  const name=document.getElementById("signup-name").value;
  const email=document.getElementById("signup-email").value;
  const pass=document.getElementById("signup-pass").value;
  auth.createUserWithEmailAndPassword(email,pass).then(c=>{
    return c.user.updateProfile({displayName:name});
  }).then(()=>{alert("Account created. Please log in.");showLogin();})
  .catch(e=>alert(e.message));
}

function doLogin(e){
  e.preventDefault();
  const email=document.getElementById("login-email").value;
  const pass=document.getElementById("login-pass").value;
  auth.signInWithEmailAndPassword(email,pass).catch(()=>alert("Invalid login."));
}

function logout(){auth.signOut();}
function showSignup(){login.style.display="none";signup.style.display="flex";}
function showLogin(){signup.style.display="none";login.style.display="flex";}

function loadChat(){
  const msgRef=db.ref("messages");
  msgRef.on("value",snap=>{
    messages.innerHTML="";
    snap.forEach(s=>{
      const m=s.val();
      const div=document.createElement("div");
      div.className="message"+(m.uid===meUid?" you":"");
      div.textContent=`${m.name}: ${m.text}`;
      div.onclick=()=>{
        if(m.uid===meUid && confirm("Delete message?")) db.ref("messages/"+s.key).remove();
      }
      messages.appendChild(div);
      messages.scrollTop=messages.scrollHeight;
    });
  });
}

function sendMessage(){
  const t=chat-input.value.trim(); if(!t) return;
  db.ref("messages").push({text:t,name:meName,uid:meUid});
  chat-input.value="";
}

function clearChat(){
  if(confirm("Clear all chat?")) db.ref("messages").remove();
}

// Load Google Sheet
fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vR48S8GQkZM2S1PMXsXjE48eGwryPuD5efwj2_RCHPsbCiMAScSiH7qBNecZk_mCQqE6h5wKB6lHJYG/pub?output=csv")
.then(r=>r.text()).then(t=>{
  const rows=t.split("\n").slice(1);
  rows.forEach(r=>{
    const c=r.split(",");
    if(c[0]){
      const tr=document.createElement("tr");
      c.forEach(x=>{const td=document.createElement("td");td.textContent=x;tr.appendChild(td)});
      schedule-body.appendChild(tr);
    }
  });
});
</script>
</body>
</html>

